let viewerPort,state={externalAppUrl:"",initialPath:null,iframeHeight:780,sessionStorageClone:{},connectMessageSent:!1};function NearSocialBridgeCore(e){const[t,a]=React.useState(state.externalAppUrl),[n,s]=React.useState(state.connectMessageSent),[o,r]=React.useState(state.iframeHeight),[i,c]=React.useState(state.sessionStorageClone);React.useEffect((()=>{const e=e=>{if(viewerPort||"connect-view"!==e.data.type||(viewerPort=e.source,a(e.data.externalAppUrl),state.externalAppUrl=e.data.externalAppUrl,state.initialPath=e.data.initialPath),viewerPort&&"view"===e.data.from){if(e.data.type.includes("core:"))return;l(e.data)}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[]);const l=e=>{document.getElementById("myIframe").contentWindow.postMessage(e,"*")},d=e=>{viewerPort.postMessage(e,"*")},p=(e,t)=>({from:"core",type:"answer",requestType:e,payload:t}),g=()=>({type:"connect",payload:{initialPath:state.initialPath},initialPath:state.initialPath,created_at:Date.now()}),h=e=>{"external-app"===e.data.from&&(e.data.type.includes("nsb:")?y(e.data):d(e.data))},y=e=>{switch(e.type){case"nsb:session-storage:hydrate-viewer":m(e.type,e.payload);break;case"nsb:session-storage:hydrate-app":w(e.type,e.payload);break;case"nsb:navigation:sync-content-height":u(e.type,e.payload),d(e)}},m=(e,t)=>{t&&(c(t),state.sessionStorageClone=t);const a=p(e,t);l(a)},w=(e,t)=>{const a=p(e,state.sessionStorageClone);l(a)},u=(e,t)=>{t.height&&(r(t.height),state.iframeHeight=t.height);const a=p(e);l(a)};return state.externalAppUrl?React.createElement("iframe",{sandbox:"allow-scripts",id:"myIframe",src:t,style:{border:"none",width:"100%",height:o+"px"},onLoad:function(e){n||(s(!0),state.connectMessageSent=!0,window.addEventListener("message",h,!1));const t=g();l(t)}}):null}const domContainer=document.querySelector("#bridge-root"),root=ReactDOM.createRoot(domContainer);root.render(React.createElement(NearSocialBridgeCore,{}));