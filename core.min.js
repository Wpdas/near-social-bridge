let viewerPort,state={externalAppUrl:"",initialPath:null,iframeHeight:480,sessionStorageClone:{},connectMessageSent:!1};function NearSocialBridgeCore(e){const[t,a]=React.useState(state.externalAppUrl),[n,s]=React.useState(state.connectMessageSent),[i,r]=React.useState(state.iframeHeight),[o,c]=React.useState(state.sessionStorageClone);React.useEffect(()=>{const e=e=>{if(viewerPort||"connect-view"!==e.data.type||(viewerPort=e.source,a(e.data.externalAppUrl),r(e.data.initialIframeHeight||480),state.externalAppUrl=e.data.externalAppUrl,state.initialPath=e.data.initialPath,state.iframeHeight=e.data.initialIframeHeight||480),viewerPort&&"view"===e.data.from){if(e.data.type.includes("core:"))return;d(e.data)}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[]);const d=e=>{document.getElementById("myIframe").contentWindow.postMessage(e,"*")},l=e=>{viewerPort.postMessage(e,"*")},p=(e,t)=>({from:"core",type:"answer",requestType:e,payload:t}),g=()=>({type:"connect",payload:{initialPath:state.initialPath},initialPath:state.initialPath,created_at:Date.now()}),h=e=>{"external-app"===e.data.from&&(e.data.type.includes("nsb:")?m(e.data):l(e.data))},m=e=>{switch(e.type){case"nsb:session-storage:hydrate-viewer":y(e.type,e.payload);break;case"nsb:session-storage:hydrate-app":u(e.type,e.payload);break;case"nsb:navigation:sync-content-height":w(e.type,e.payload),l(e)}},y=(e,t)=>{t&&(c(t),state.sessionStorageClone=t);const a=p(e,t);d(a)},u=(e,t)=>{const a=p(e,state.sessionStorageClone);d(a)},w=(e,t)=>{t.height&&(r(t.height),state.iframeHeight=t.height);const a=p(e);d(a)};return state.externalAppUrl?React.createElement("iframe",{sandbox:"allow-scripts",id:"myIframe",src:t,style:{border:"none",width:"100%",height:i+"px",margin:0,padding:0},onLoad:function(e){n||(s(!0),state.connectMessageSent=!0,window.addEventListener("message",h,!1));const t=g();d(t),setTimeout(()=>{d(t)},2e3)}}):null}const domContainer=document.querySelector("#bridge-root"),root=ReactDOM.createRoot(domContainer);root.render(React.createElement(NearSocialBridgeCore,{}));