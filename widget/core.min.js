let viewerPort,state={externalAppUrl:"",initialPath:null,iframeHeight:480,userInfo:null,initialPayload:{},sessionStorageClone:{},connectMessageSent:!1};function NearSocialBridgeCore(e){const[t,a]=React.useState(state.externalAppUrl),[n,s]=React.useState(state.connectMessageSent),[o,i]=React.useState(state.iframeHeight),[,r]=React.useState(state.sessionStorageClone),[,l]=React.useState(state.userInfo);React.useEffect(()=>{const e=e=>{if(viewerPort||"connect-view"!==e.data.type||(viewerPort=e.source,a(e.data.externalAppUrl),i(e.data.initialIframeHeight||480),l(e.data.userInfo),state.externalAppUrl=e.data.externalAppUrl,state.initialPath=e.data.initialPath,state.userInfo=e.data.userInfo,state.initialPayload=e.data.initialPayload,state.iframeHeight=e.data.initialIframeHeight||480),viewerPort&&"view"===e.data.from){if(e.data.type.includes("core:"))return;d(e.data)}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[]);const d=e=>{document.getElementById("myIframe").contentWindow.postMessage(e,"*")},c=e=>{viewerPort.postMessage(e,"*")},p=(e,t)=>({from:"core",type:"answer",requestType:e,payload:t}),g=()=>({type:"connect",payload:{userInfo:state.userInfo,initialPath:state.initialPath,initialPayload:state.initialPayload},created_at:Date.now()}),u=e=>{"external-app"===e.data.from&&(e.data.type.includes("nsb:")?y(e.data):c(e.data))},y=e=>{switch(e.type){case"nsb:session-storage:hydrate-viewer":m(e.type,e.payload);break;case"nsb:session-storage:hydrate-app":f(e.type,e.payload);break;case"nsb:navigation:sync-content-height":h(e.type,e.payload),c(e);break;case"nsb:auth:get-user-info":c(e)}},m=(e,t)=>{t&&(r(t),state.sessionStorageClone=t);const a=p(e,t);d(a)},f=e=>{const t=p(e,state.sessionStorageClone);d(t)},h=(e,t)=>{t.height&&(i(t.height),state.iframeHeight=t.height);const a=p(e);d(a)};return state.externalAppUrl?React.createElement("iframe",{sandbox:"allow-scripts allow-popups-to-escape-sandbox allow-popups",id:"myIframe",src:t,style:{border:"none",width:"100%",height:o+"px",margin:0,padding:0},onLoad:function(e){n||(s(!0),state.connectMessageSent=!0,window.addEventListener("message",u,!1));const t=g();d(t),setTimeout(()=>{d(g())},2e3)}}):null}const domContainer=document.querySelector("#bridge-root"),root=ReactDOM.createRoot(domContainer);root.render(React.createElement(NearSocialBridgeCore,{}));